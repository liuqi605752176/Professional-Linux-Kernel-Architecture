## 第一章 绪论
### 1.1 内核的任务
>内核是硬件与软件之间的一个中间层，其作用就是将应用程序的请求传递给硬件，并充当底层驱动程序，对系统中的各种设备和组件进行寻址。
### 1.2 实现策略
>两种泛型：<br>
>1.__微内核__：
>只有最基本的功能直接由中央内核（即微内核）实现。所有其他的功能都委托给一些独立进程，这些进程通过明确定义的通信接口与中心内核通信,系统的各个部分彼此都很清楚地划分开来 <br>
>**好处**：动态可扩展性和在运行时切换重要组件<br>
>**不足**：复杂通信需要额外的CPU时间<br>
>2.__宏内核__:<br>
>内核的全部代码，包括所有子系统（如内存管理、文件系统、设备驱动程序）都打包到一个文件中。内核中的每个函数都可以访问内核中所有其他部分
### 1.3 内核的组成部分
#### 1.3.1 进程、进程切换、调度
>每个进程都在CPU的虚拟内存中分配地址空间。各个进程的地址空间是完全独立的，因此进程并不会意识到彼此的存在。从进程的角度来看，它会认为自己是系统中唯一的进程。如果进程想要彼此通信（例如交换数据），那么必须使用特定的内核机制。由于linux是多任务系统，内核会按照短的时间间隔在不同的进程之间切换，这样就造成了同时处理多进程的假象。
>进程之间的切换称之为进程切换
>确定哪个进程运行多长时间的过程称之为调度
#### 1.3.2 UNIX进程
>Linux对进程采用了一种层次系统，每个进程都依赖于一个父进程。内核启动Init程序作为第一个进程，该进程负责进一步的系统初始化操作，Init是进程树的根，所有进程都直接或间接起源自该进程。
>UNIX操作系统中有两种创建新进程的机制，分别是 *fork* 和 *exec*。<br>
>① __fork__:<br>
>fork可以创建当前进程的一个副本，父进程和子进程只有PID（进程ID）不同,利用一种写实复制的技术，将内存复制操作延迟到父进程或子进程向某内存页面写入数据之前。总的来说，fork之后的任务都将被复制，两个进程执行相同的操作<br>
>② __exec__:<br>
>exec将一个新程序加载到当前进程的内存中并执行，原来内存页中的就程序被清除，被新程序替换。
#### 1.3.3 地址空间与特权级别
>每个进程的虚拟地址空间是3GB，由于虚拟地址空间总长度4GB，故内核占有1G空间。地址空间虚拟的，所以每个用户进程都认为自身有3GB的内存。各个系统进程的用户空间是彼此分离的，而内核空间是唯一的，都是同样的。
#### 1.3.4 页表
>内核和CPU用页表将物理内存映射到虚拟地址空间，虚拟地址关系到进程的用户空间和内核空间，而物理地址用来寻址可用的内存。
>物理内存页经常被称为页帧，为了减少页表的大小，将虚拟地址分为多个部分，linux采用了四级页表：<br>
>第一部分：全局页目录（Page Global Directory，PGD）。PGD用于索引进程中的一个数组（每个进程有且仅有一个），该数组是所谓的全局页目录或PGD。PGD的数组项指向另一些数组的起始地址，这些数组称为中间页目录（Page Middle Directory，PMD）<br>
>第二部分：PMD，在通过PGD中的数组项找到对应的PMD之后，则使用PMD来索引PMD。PMD的数组项也是指针，指向下一级数组，称为页表或页目录<br>
>第三部分：PTE（Page Table Entry，页表数组），用作页表的索引。虚拟内存页和页帧之间的映射就此完成，因为页表的数组项是指向页帧的<br>
>第四部分：偏移量。它指定了页内部的一个字节位置。归根结底，每个地址都指向地址空间中唯一定义的某个字，每次访问内存都必须一级一级的去访问才能将虚拟地址转换为物理地址，必然会拖慢速度，所以采用了两种方法进行加速：<br>
>1.MMU(Memory Management Unit 内存管理单元)，优化内存访问操作。<br>
>2.在地址转换中频繁出现的地址，将这些地址保存到地址转换后被缓冲器(TLB)的CPU高速缓存中，下次在访问该地址，可以直接从高速缓存中直接获取地址数据。<br>
#### 1.3.7 系统调用
>进程管理：创建新进程，查询信息，调试。<br>
>信号：发送信号，定时器以及相关处理机制。<br>
>文件：创建、打开和关闭文件，从文件读取和向文件写入，查询信息和状态。<br>
>目录和文件系统：创建、删除和重命名目录，查询信息，链接，变更目录。<br>
>保护机制：读取和变更UID/GID，命名空间的处理。<br>
>定时器函数：定时器函数和统计信息。<br>

>对所有的处理器来说，一个共同点就是：用户进程要从用户状态切换到核心态，并将系统关键任务委派给内核执行，系统调用是必由之路<br>
#### 1.3.8 设备驱动程序、块设备和字符设备
>Everything is a file------万物皆文件<br>
>对外设的访问可利用/dev目录下的设备文件夹完成，外设可分为两类<br>
>1.字符设备：提供连续的数据流，应用程序可以顺序读取，通常不支持随机存取<br>
>2.块设备：应用程序可以随机访问设备数据，程序可自行确定读取数据的位置。硬盘是典型的块设备，数据的读写只能以块（通常是512B）的倍数进行。与字符设备不同，块设备并不支持基于字符的寻址<br>
#### 1.3.9 网络
>在网络通信期间，数据打包到了各种协议层中。在接收到数据时，内核必须针对各协议层的处理，对数据进行拆包与分析，然后才能将有效数据传递给应用程序。在发送数据时，内核必须首先根据各个协议层的要求打包数据，然后才能发送、
#### 1.3.15 数据类型
>1.字节序：<br>
>大端序：高字节存储在低地址<br>
>小端序：低字节存储在低地址<br>











